<!DOCTYPE html>
<html lang="en">

<head>
    <title>Sobre <%= title %>
    </title>
    <link rel="stylesheet" href="/stylesheets/bootstrap.min.css">
    <link rel="stylesheet" href="/stylesheets/estilos_horario.css"> <!-- Estilos del horario en public -->
    <script src="/sweetalert2/sweetalert2.all.min.js"></script> <!-- Alertas -->
</head>

<body>
    <%- include("../plantillas/header_trabajadores.ejs") %>

        <h1>Horario del trabajador</h1>

        <% 
        const algo = ['10:00:00', '11:00:00', '12:00:00', '13:00:00', '14:00:00','14:30:00', '15:00:00', '16:00:00', '17:00:00', '18:00:00', '19:00:00', '20:00:00'];
        const horasDelDia = [
        '10:00:00', '10:30:00',
        '11:00:00', '11:30:00',
        '12:00:00', '12:30:00',
        '13:00:00', '13:30:00',
        '14:00:00', '14:30:00',
        '15:00:00', '15:30:00',
        '16:00:00', '16:30:00',
        '17:00:00', '17:30:00',
        '18:00:00', '18:30:00',
        '19:00:00', '19:30:00',
        '20:00:00'
];
        const diasLaborables = ['Lunes', 'Martes', 'Miércoles', 'Jueves', 'Viernes'];
        const horasDeDescanso = ['15:00:00','15:30:00', '16:00:00']; // Estas horas no se trabajan

    %>

        <table>
            <thead>
                <tr>
                    <th>Hora</th>
                    <!-- Cargar dias y fechas de esos dias -->
                    <% for (let i = 0; i < diasLaborables.length; i++) { %>
                        <th>
                            <%= diasLaborables[i] %><br>
                            <small><%= diasLaborablesSemanaActual[i] %></small>
                        </th>
                    <% } %>
                    </tr>
                </tr>
            </thead>
            <tbody>
                <% horasDelDia.forEach(horaActual => { %>
                    <tr>
                        <!-- Columna de la hora -->
                        <td><%= horaActual.substring(0, 5) %></td>
                
                        <% diasLaborables.forEach((diaActual, index) => {
                            // Buscar si hay una cita en esta fecha y hora
                            const cita = citasSemana.find(c =>
                                new Date(c.fecha).toLocaleDateString('es-ES') === diasLaborablesSemanaActual[index] &&
                                c.hora_inicio <= horaActual && // La hora de inicio de la cita es antes o igual a la hora actual
                                c.hora_fin > horaActual // La hora de fin de la cita es después de la hora actual
                            );
            
                            // Establecer la clase para la celda
                            let claseCelda = '';
            
                            if (cita) {
                                // Si hay una cita, marcar la celda con la clase "cita"
                                claseCelda = 'cita';
                            } else {
                                // Si no hay cita, comprobar otras condiciones como descanso, festivo, etc.
                                const trabajaEnEstaHora = horarioTrabajador.find(turno =>
                                    turno.dia === diaActual &&
                                    horaActual >= turno.hora_inicio &&
                                    horaActual <= turno.hora_fin &&
                                    !horasDeDescanso.includes(horaActual)
                                );
                
                                const esFestivo = festivosSemana.some(festivo => 
                                    festivo.slice(0, 10) === diasLaborablesSemanaActual[index]
                                );
                
                                claseCelda = horasDeDescanso.includes(horaActual)
                                    ? 'descanso'
                                    : (trabajaEnEstaHora ? 'horario-activo' : '') + (esFestivo ? ' festivo' : '');
                            }
            
                        %>

                        <td class="<%= claseCelda %>" <%= cita ? `data-id=${cita.id_cita}` : '' %>>
                            <%= (cita && horaActual === cita.hora_inicio) ? cita.motivo : '' %>
                        </td>



                        <% }) %>
                    </tr>
                <% }) %>
            </tbody>
            
            
            
        


        <script src="/javascripts/bootstrap.bundle.min.js"></script>
        <script src="/javascripts/funcionesHorarioCitas.js"></script> <!-- Para hacer que aparezca dinamicamente la infromación de la cita en el lateral -->

</body>

</html>
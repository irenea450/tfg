<!DOCTYPE html>
<html lang="en">

<head>
    <title>Sobre <%= title %>
    </title>
    <link rel="stylesheet" href="/stylesheets/bootstrap.min.css">
    <style>
        table, th, td {
            border: 1px solid black;
            text-align: center;
            padding: 1px 40px;
        }
        .horario-activo {
            background-color: #8df59d; /* verde clarito */
        }
        .descanso{
            background-color: pink;
        }
        .festivo {
            background-color: #e73330; /* Un rojo para los festivos */
        }

        .cita {
            background-color: #add8e6; /* azul claro */
        }
    </style>
</head>

<body>
    <%- include("../plantillas/header_trabajadores.ejs") %>

        <h1>Horario del trabajador</h1>

        <% 
        const algo = ['10:00:00', '11:00:00', '12:00:00', '13:00:00', '14:00:00','14:30:00', '15:00:00', '16:00:00', '17:00:00', '18:00:00', '19:00:00', '20:00:00'];
        const horasDelDia = [
        '10:00:00', '10:30:00',
        '11:00:00', '11:30:00',
        '12:00:00', '12:30:00',
        '13:00:00', '13:30:00',
        '14:00:00', '14:30:00',
        '15:00:00', '15:30:00',
        '16:00:00', '16:30:00',
        '17:00:00', '17:30:00',
        '18:00:00', '18:30:00',
        '19:00:00', '19:30:00',
        '20:00:00'
];
        const diasLaborables = ['Lunes', 'Martes', 'Mi√©rcoles', 'Jueves', 'Viernes'];
        const horasDeDescanso = ['15:00:00','15:30:00', '16:00:00']; // Estas horas no se trabajan

    %>

        <table>
            <thead>
                <tr>
                    <th>Hora</th>
                    <!-- Cargar dias y fechas de esos dias -->
                    <% for (let i = 0; i < diasLaborables.length; i++) { %>
                        <th>
                            <%= diasLaborables[i] %><br>
                            <small><%= diasLaborablesSemanaActual[i] %></small>
                        </th>
                    <% } %>
                    </tr>
                </tr>
            </thead>
            <tbody>
                <% horasDelDia.forEach(horaActual => { %>
                    <tr>
                        <!-- Columna de la hora -->
                        <td><%= horaActual.substring(0, 5) %></td> <!-- Poner en formato de 10:00 -->
        
                        <% diasLaborables.forEach((diaActual, index) => {
                            // Comprobar si el trabajador est√° trabajando en esa hora y ese d√≠a.
                            const trabajaEnEstaHora = horarioTrabajador.find(turno => 
                                turno.dia === diaActual && // ver si ese d√≠a trabaja
                                horaActual >= turno.hora_inicio && // Verificar si la hora est√° dentro del turno comprobando el inicio de hora
                                horaActual <= turno.hora_fin && // Verificar si la hora est√° dentro del turno comprobando el fin de hora
                                !horasDeDescanso.includes(horaActual) // Descontar horas de descanso
                            );
        
                            // Comprobar si el d√≠a es festivo
                            const esFestivo = festivosSemana.some(festivo => {
                                // Compara solo la fecha (sin la hora)
                                return festivo.slice(0, 10) === diasLaborablesSemanaActual[index]; // Compara solo la parte de la fecha
                            });

                            // Buscar si hay cita en esta fecha y hora
                            const cita = citasSemana.find(c =>
                                new Date(c.fecha).toLocaleDateString('es-ES') === diasLaborablesSemanaActual[index] && c.hora_inicio === horaActual
                            );

                            // üí° Elegimos la clase de la celda seg√∫n lo que haya
                            const claseCelda = cita
                                ? 'cita'
                                : (horasDeDescanso.includes(horaActual)
                                    ? 'descanso'
                                    : (trabajaEnEstaHora ? 'horario-activo' : '')) + (esFestivo ? ' festivo' : '')
                            ;


                        %>
                        
                        <td class="<%= claseCelda %>" <%= cita ? `title="${cita.motivo}"` : '' %>></td>
                        <% }) %>

                    </tr>
                <% }) %>
            </tbody>
            
        


        <script src="/javascripts/bootstrap.bundle.min.js"></script>

</body>

</html>
<!DOCTYPE html>
<html>

<head>
    <title>Datos</title>
    <link rel="stylesheet" href="/stylesheets/bootstrap.min.css">
    <link rel="stylesheet" href="/stylesheets/estilos_pacientes.css"><!-- estilos comunes en ejs de pacientes -->

    <script src="/sweetalert2/sweetalert2.all.min.js"></script>
</head>

<%- include("../plantillas/header_pacientes.ejs") %>

    <div class="container ">

        <h3 class="titulo bg-primary text-white p-2 my-4 rounded"> <i class="bi bi-person"></i>Datos de la Cuenta</h3>

        <form action="/zona/paciente/datos" method="POST">

            <div class="row my-2">

                <div class="col">
                    <label for="nombre">Nombre</label>
                    <input type="text" class="form-control my-1" name="nombre" placeholder="Nombre" value="<%- paciente.nombre %>" required>
                </div>
                <div class="col">
                    <label for="apellidos">Apellidos</label>
                    <input type="text" class="form-control my-1" name="apellidos" value="<%- paciente.apellidos %>"  placeholder="Apellido 1 Apellido 2" required>
                </div>
                <div class="col">
                    <label for="dni">DNI:</label>
                    <input type="text" class="form-control my-1" name="dni" value="<%- paciente.id_paciente %>" placeholder="00000000A" required readonly onclick="mostrarAlertaDNI()">
                </div>
                <div class="col">
                    <label for="fecha_nacimiento">Fecha nacimiento</label>
                    <% const fechaFormateada = new Date(paciente.fecha_nacimiento).toISOString().split('T')[0] %>
                    <input type="date" class="form-control my-1" name="fecha_nacimiento" value="<%= fechaFormateada %>" placeholder="Apellido 1 Apellido 2" required>
                </div>

            </div>

            <div class="row my-3">

                <div class="col-3">
                    <select class="col form-select" name="sexo">
                        <option selected>Selecciona el sexo</option>
                        <option value="Hombre"  <%= paciente.sexo === 'Hombre' ? 'selected' : '' %> >Hombre</option>
                        <option value="Mujer"<%= paciente.sexo === 'Mujer' ? 'selected' : '' %> >Mujer</option>
                        <option value="No especificado" <%= paciente.sexo === 'No especificado' ? 'selected' : '' %> >No especificado</option>
                    </select>
                </div>

                <div class="col ">
                    <input type="text" class="form-control " value="<%- paciente.correo %>" placeholder="Correo" name="correo" pattern=".+@.+\..+" required readonly>
                </div>

                <div class="col-3">
                    <input type="tel" class="form-control" value="<%- paciente.tlf %>" name="tlf" placeholder="Teléfono" maxlength="9" required>
                </div>

            </div>

            <div class="row">
                <label>Datos del domicilio</label>
                <div class="col-4">
                    <input type="text" class="form-control my-1" name="domicilio" value="<%- paciente.domicilio %>" placeholder="Calle , número, puerta, código postal" required>
                </div>

            </div>


            <div class="row p-0 my-5">
                <div class="d-grid gap-2 col-6 mx-auto">
                    <button type="submit" class="btn btn-primary">Guardar Cambios</button>
                </div>
            </div>

        </form>

        <h3 class="titulo2  p-2 my-4 rounded">Cambiar contraseña</h3>

        <!-- Formulario de cambio de contraseña -->
        <form action="/zona/paciente/contrasena" method="POST">
            <div class="row g-3 align-items-center p-0 m-0">
                <div class="col-auto">
                    <label for="contraseña" class="col-form-label">Nueva contraseña</label>
                </div>
                <div class="col-auto">
                    <input type="password" name="contraseña" id="contraseña" class="form-control" required>
                </div>
                <div class="col-auto">
                    <span id="passwordHelpInline" class="form-text">
                        Establece una contraseña segura
                    </span>
                </div>
                <div class="col-auto">
                    <label for="contraseña" class="col-form-label">Confirmar contraseña</label>
                </div>
                <div class="col-auto">
                    <input type="password" name="confrimarContraseña" id="confrimarContraseña" class="form-control" required>
                </div>
            </div>
        
            <div class="row p-0 my-4">
                <div class="d-grid gap-2 col-6 mx-auto">
                    <button type="submit" class="btn btn-success">Cambiar Contraseña</button>
                </div>
            </div>
        </form>
        <h3 class="titulo2  p-2 my-4 rounded">Eliminar cuenta</h3>

        <!-- Formulario de cambio de contraseña -->
        <form action="/zona/paciente/eliminar-cuenta" id="formEliminarCuenta" method="POST">

            <div class="row p-0 my-4">
                <div class="d-grid gap-2 col-6 mx-auto">
                    <button type="submit" class="btn btn-danger" onclick="confirmarEliminarCuenta(event)" >Eliminar cuenta</button>
                </div>
            </div>
        </form>

    </div>

    <% if (typeof mensajeExito !== 'undefined') { %>
        <script>
            Swal.fire({
                icon: 'success',
                title: 'Éxito',
                text: '<%= mensajeExito %>',
                timer: 2500,
                showConfirmButton: false,
                confirmButtonColor: '#3085d6'
            });
        </script>
    <% } %>
    
    <% if (typeof mensajeError !== 'undefined') { %>
        <script>
            Swal.fire({
                icon: 'error',
                title: 'Error',
                text: '<%= mensajeError %>',
                timer: 2500,
                showConfirmButton: false,
                confirmButtonColor: '#d33'
            });
        </script>
    <% } %>

    <script>
        //alerta de que el dni no es editable
        function mostrarAlertaDNI() {
            Swal.fire({
                title: 'DNI no editable',
                text: 'Este campo no se puede modificar. Si hay un error, contacte con la clínica.',
                icon: 'info',
                confirmButtonText: 'Entendido',
                confirmButtonColor: '#3085d6',
            });
        }

        //Alerta de confirmar que se elimina la cuenta
        function confirmarEliminarCuenta(event) {
            event.preventDefault(); // Detener el envío automático

            Swal.fire({
                title: '¿Confirmas que quieres anular esta cita?',
                text: 'Esta acción no se puede deshacer',
                icon: 'question',
                showCancelButton: true,
                confirmButtonColor: '#d33',
                cancelButtonColor: '#6c757d',
                confirmButtonText: 'Si, eliminar',
                cancelButtonText: 'Cancelar'
            }).then((result) => {
                if (result.isConfirmed) {
                    document.getElementById('formEliminarCuenta').submit();
                }
            });
        }
    </script>

            <script src="/javascripts/bootstrap.bundle.min.js"></script>

</html>